var webStorageModule=angular.module("webStorageModule",[]);webStorageModule.constant("defaultSettings",{prefix:"",order:["local","session","memory"],errorName:"webStorage.notification.error"}),webStorageModule.factory("webStorage",["$rootScope","defaultSettings",function($rootScope,defaultSettings){"use strict";function addToLocal(key,value){if(hasLocalStorage){try{localStorage.setItem(prefix+key,JSON.stringify(value))}catch(e){return croak(e)}return!0}return!1}function addToSession(key,value){if(hasSessionStorage){try{sessionStorage.setItem(prefix+key,JSON.stringify(value))}catch(e){return croak(e)}return!0}return!1}function addToMemory(key,value){return ram[key]=value,!0}function getFromLocal(key){if(hasLocalStorage)try{var value=localStorage.getItem(prefix+key);return value&&JSON.parse(value)}catch(e){return croak(e),null}return null}function getFromSession(key){if(hasSessionStorage)try{var value=sessionStorage.getItem(prefix+key);return value&&JSON.parse(value)}catch(e){return croak(e),null}return null}function getFromMemory(key){return key in ram?ram[key]:null}function removeFromLocal(key){if(hasLocalStorage){try{localStorage.removeItem(prefix+key)}catch(e){return croak(e)}return!0}return!1}function removeFromSession(key){if(hasSessionStorage){try{sessionStorage.removeItem(prefix+key)}catch(e){return croak(e)}return!0}return!1}function removeFromMemory(key){return delete ram[key],!0}function clearLocal(){if(!hasLocalStorage)return!1;if(prefix){var prefixLength=prefix.length;try{for(var key in localStorage)key.substr(0,prefixLength)===prefix&&localStorage.removeItem(key)}catch(e){return croak(e)}return!0}try{localStorage.clear()}catch(e){return croak(e)}return!0}function clearSession(){if(!hasSessionStorage)return!1;if(prefix){var prefixLength=prefix.length;try{for(var key in sessionStorage)key.substr(0,prefixLength)===prefix&&sessionStorage.removeItem(key)}catch(e){return croak(e)}return!0}try{sessionStorage.clear()}catch(e){return croak(e)}return!0}function clearMemory(){return ram={},!0}function testLocalStorage(){try{return localStorage.setItem(prefix+"angular.webStorage.test",!0),localStorage.removeItem(prefix+"angular.webStorage.test"),!0}catch(e){return!1}}function testSessionStorage(){try{return sessionStorage.setItem(prefix+"angular.webStorage.test",!0),sessionStorage.removeItem(prefix+"angular.webStorage.test"),!0}catch(e){return!1}}function croak(error){return $rootScope.$broadcast(errorName,error.title+": "+error.message),!1}var errorName=defaultSettings.errorName,hasLocalStorage=testLocalStorage(),hasSessionStorage=testSessionStorage(),order=defaultSettings.order,prefix=defaultSettings.prefix,ram={},webStorage={isSupported:hasLocalStorage||hasSessionStorage,local:{isSupported:hasLocalStorage,add:addToLocal,get:getFromLocal,remove:removeFromLocal,clear:clearLocal},session:{isSupported:hasSessionStorage,add:addToSession,get:getFromSession,remove:removeFromSession,clear:clearSession},memory:{isSupported:!0,add:addToMemory,get:getFromMemory,remove:removeFromMemory,clear:clearMemory}};return webStorage.add=function(key,value,allEngines){allEngines="undefined"!=typeof allEngines?!!allEngines:!1;for(var result=!1,length=order.length,ith=0;length>ith;++ith){var engine=webStorage[order[ith]];if(engine.isSupported&&(result=engine.add(key,value)||result,!allEngines))return result}return result},webStorage.get=function(key,allEngines){allEngines="undefined"!=typeof allEngines?!!allEngines:!0;for(var length=order.length,ith=0;length>ith;++ith){var engine=webStorage[order[ith]];if(engine.isSupported){var value=engine.get(key);if(!allEngines||null!==value)return value}}return null},webStorage.remove=function(key,allEngines){allEngines="undefined"!=typeof allEngines?!!allEngines:!0;for(var result=!1,length=order.length,ith=0;length>ith;++ith){var engine=webStorage[order[ith]];if(engine.isSupported&&(result=engine.remove(key)||result,!allEngines))return result}return result},webStorage.clear=function(allEngines){allEngines="undefined"!=typeof allEngines?!!allEngines:!0;for(var result=!1,length=order.length,ith=0;length>ith;++ith){var engine=webStorage[order[ith]];if(engine.isSupported&&(result=engine.clear()||result,!allEngines))return result}return result},webStorage.errorName=function(newErrorName){var result=errorName;if("undefined"!=typeof newErrorName){if("string"!=typeof newErrorName)return!1;errorName=newErrorName}return result},webStorage.order=function(newOrder){var result=angular.copy(order);if("undefined"!=typeof newOrder){order=[];for(var ith in newOrder)/^(local|session|memory)$/.test(newOrder[ith])&&order.push(newOrder[ith])}return result},webStorage.prefix=function(newPrefix){var result=prefix;if("undefined"!=typeof newPrefix){if("string"!=typeof newPrefix)return!1;prefix=newPrefix}return result},webStorage}]);try{window.localStorage||(window.localStorage={getItem:function(sKey){return sKey&&this.hasOwnProperty(sKey)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(nKeyId){return unescape(document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/)[nKeyId])},setItem:function(sKey,sValue){sKey&&(document.cookie=escape(sKey)+"="+escape(sValue)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/",this.length=document.cookie.match(/\=/g).length)},length:0,removeItem:function(sKey){sKey&&this.hasOwnProperty(sKey)&&(document.cookie=escape(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.length--)},hasOwnProperty:function(sKey){return new RegExp("(?:^|;\\s*)"+escape(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}},window.localStorage.length=(document.cookie.match(/\=/g)||window.localStorage).length),window.sessionStorage||(window.sessionStorage={getItem:function(sKey){return sKey&&this.hasOwnProperty(sKey)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(nKeyId){return unescape(document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/)[nKeyId])},setItem:function(sKey,sValue){sKey&&(document.cookie=escape(sKey)+"="+escape(sValue)+"; path=/",this.length=document.cookie.match(/\=/g).length)},length:0,removeItem:function(sKey){sKey&&this.hasOwnProperty(sKey)&&(document.cookie=escape(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.length--)},hasOwnProperty:function(sKey){return new RegExp("(?:^|;\\s*)"+escape(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}},window.sessionStorage.length=(document.cookie.match(/\=/g)||window.sessionStorage).length)}catch(e){}